

[TOC]



## 数据处理

### 预设场景一

#### 描述

应用情况：有N台应用，N<10，N台应用都有定时任务，且集成了分布式任务，但缺少分片中间件的支撑。

数据情况：有千万级数据需要被读，然后处理。

期望情况：尽可能的快速处理完数据。

#### 业内背景

除了大数据下的MapReduce编程模型（我认为，一家公司的大数据的生态需要强大的后备力量支撑，不然，作为一名业务的软件开发工程师，很难做到拿来即用，另外千万级数据量对于他真是大材小用），业内针对大数据的处理方式还有：多台应用进行分片处理，关于分片处理相关理论的内容很多，基本上是一看就懂，且分片处理大抵都是附在为解决某一领域问题而出现的开源框架上。比如为了解决大数据库集群库问题的MyCat，为了解决分布式数据库的ShardingSphere，为了解决分布式定时任务的Elastic-job等等。

#### 设计方案

在结合业内背景加现有业务的情况下，本场景决定最终采用分片处理的方式。

TODO 此处应有图

##### 细节

###### 如何调度？

定时任务调度中心每隔一定的时间，触发全部机器的定时任务。

###### 如何分片？

1. Hash

   - 直接定址法： 是以数据元素关键字k本身或它的线性函数作为它的哈希地址，即：hash（k）=k 或 hash（k）=a*k+b ； (其中a,b为常数)。此法仅适合于：地址集合的大小 = = 关键字集合的大小，比如以年龄为key，以年龄对应的人数为value
   - 数字分析法：假设关键字集合中的每个关键字都是由 s 位数字组成 (u1, u2, …, us)，分析关键字集中的全体，并从中提取分布均匀的若干位或它们的组合作为地址。它只适合于所有关键字值已知的情况。
   - 折叠法： 将关键字分割成若干部分，然后取它们的叠加和，留下t位作为哈希地址。适用于关键字位数较多，而且关键字中每一位上数字分布大致均匀的情况。
   - **平方取中法：** 这是一种常用的哈希函数构造方法。这个方法是先取关键字的平方，然后根据可使用空间的大小，选取平方数是中间几位为哈希地址。
   - 减去法：数据的键值减去一个特定的数值以求得数据存储的位置。
   - **除留余数法：**这是一种常用的哈希函数构造方法。假设哈希表长为m，p为小于等于m的最大素数，则哈希函数为hash（k）=k % p ，其中%为模p取余运算。

   Hash处理冲突方法：

	- 开放定址法：这种方法也称探测散列法，其基本思想是：当关键字key的哈希地址p=hash（key）出现冲突时，以p为基础，产生另一个哈希地址p1，如果p1仍然冲突，再以p1为基础，产生另一个哈希地址p2，…，直到找出一个不冲突的哈希地址pi ，将相应元素存入其中。这种方法有一个通用的再散列函数形式：
    Hi=(hash(key)+f(i))% m i=1，2，…，n
    　　其中hash（key）为关键字key的直接散列地址，m 为表长，f(i)称为增量序列，表示每次再探测试时的地址增量。

2. 数据分段

   - 按照索引分段
   - 按照某个业务属性分段

3. 布隆过滤器（Bloom filter）

##### 问题

- 分段数据过大？



#### 实现

